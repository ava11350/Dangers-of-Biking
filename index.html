<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Dangers of Biking</title>
  <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
      
  <link rel="shortcut icon" href="./favicon_io/favicon.ico" />

  <style>
    :root {
      --mdc-theme-primary: #789B5D;
    }
      
      .mdc-list-item--activated{
          color: #BB873C !important;
      }
      .mdc-list-item__graphic{
          color: #5A7D3F !important;
      }
       
      .hidden{
          display:none;
      }
      
      .view {
          display:none;
      }
      
      #map {
        height: 100%;
        width:100%
      }
      
      .mapContent{
          font-family: "Lucida Console", Courier, monospace;
      }
      
      .aboutContent{
          font-family: "Lucida Console", Courier, monospace;
          text-align:center;   
      }
      
      .settingsContent{
          font-family: "Lucida Console", Courier, monospace;
          text-align:left;
      }
      
      .mdc-card {
          height:750px;
          width:600px;
          margin:15px;
      }
      
      .viewActive{
          display:flex;
          padding:0px;
          justify-content:center;
          align-items:center;
      }
      
      .weatherContent{
          background-color:#789B5D;
      }
      
    body {margin: 0;}
    main {margin-left: 8px;}
  </style>

  </head>
    
  <body>  
    
    <!-- Top app bar hamburger -->
    <aside class="mdc-drawer mdc-drawer--modal">
    <div class="mdc-drawer__content">
      <nav class="mdc-list">
        <a class="mdc-list-item mdc-list-item--activated" href="#map-layer" aria-current="page" id="mapTopAppTarget">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">map</i>
          <span class="mdc-list-item__text">Map</span>
        </a>
        <a class="mdc-list-item" href="#settings">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</i>
          <span class="mdc-list-item__text">Settings</span>
        </a>
        <a class="mdc-list-item" href="#about">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">supervised_user_circle</i>
          <span class="mdc-list-item__text">About</span>
        </a>
      </nav>
    </div>
  </aside>

      <div class="mdc-drawer-scrim"></div>

    <!-- Top app bar -->
    <header class="mdc-top-app-bar">
  <div class="mdc-top-app-bar__row">
    <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
      <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
      <span class="mdc-top-app-bar__title" id="top-app-bar-title">Map</span>
    </section>
    <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
      <!--<button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Download">file_download</button>
      <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Print this page">print</button>
      <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Bookmark this page">bookmark</button>-->
    </section>
  </div>
</header>



  <main class="mdc-top-app-bar--fixed-adjust">
    <div class="viewActive" id="map-layer">
        <h1 class="hidden">Map</h1>
        <div class="mdc-card mdc-elevation--z8">
            <div id="map" style="width:600px;height:700px"></div>
            <div class="weatherContent mapContent" id="weatherSection">
                <ul class="mdc-list">
                    <li class="mdc-list-item" tabindex="0">
                        <img alt="Weather Icon" id="weatherICON">
                        <span class="mdc-list-item__text" id="weatherText">Weather update</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
      
    <div class="view" id="settings">
        <h1 class="hidden">Settings</h1>
        <div class="settingsContent">
            <div class="mdc-card mdc-elevation--z8">
                <p id="demo" style="padding-left:15px"></p>
                <div class="mdc-card__actions" tabindex="0">
                    <button class="mdc-button foo-button mdc-button--raised mdc-card__action mdc-card__action-button" onclick="getLocation()">
                        <div class="mdc-button__ripple"></div>
                        <span class="mdc-button__label">Update Location</span>
                    </button>
                </div>
                <p style="padding-left:15px"><u>Temperature:</u></p>
                <div class="mdc-form-field">
                    <div class="mdc-radio">
                        <input class="mdc-radio__native-control" type="radio" id="Celcius" name="temperature">
                        <div class="mdc-radio__background">
                            <div class="mdc-radio__outer-circle"></div>
                            <div class="mdc-radio__inner-circle"></div>
                        </div>
                        <div class="mdc-radio__ripple"></div>
                    </div>
                    <label for="Celcius">Celcius</label>
                </div>

                <div class="mdc-form-field">
                    <div class="mdc-radio">
                        <input class="mdc-radio__native-control" type="radio" id="Farenheit" name="temperature" checked>
                        <div class="mdc-radio__background">
                            <div class="mdc-radio__outer-circle"></div>
                            <div class="mdc-radio__inner-circle"></div>
                        </div>
                        <div class="mdc-radio__ripple"></div>
                    </div>
                    <label for="Farenheit">Farenheit</label>
                </div>
            </div>
        </div>
    </div>
      
    <div class="view" id="about">
        <h1 class="hidden">About</h1>
        <div class="mdc-card mdc-elevation--z8" style="height:625px">
            <div class="aboutContent">
                <h2>Dangers of Biking</h2>
                <h4>Created by Ava Smith</h4>
                <img src="./author_img.jpg" style="width:300px;height:300px;padding-left:150px;padding-right:150px">
                <p style="padding:15px">This project was aimed to give bikers a better idea of safe routes through the city. Additionally, we show forecasted
                weather to allow for safe planning. </p>

                <p style="padding:15px">Currently this project only works for Chicago. We use the google maps API to render the bike layer, 
                    City of Chicago API to pull accident data, and the OpenWeatherMap API to get realtime weather updates. </p>
            </div>
        </div>
    </div>
    
  </main>


  <script>
    mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));

    mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('header.mdc-top-app-bar'));

    const drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
   
    document.querySelector("main.mdc-top-app-bar--fixed-adjust div#map-layer").style.display="block";
    
    /* Handles Opening Drawer */  
    document.querySelector(".mdc-top-app-bar__navigation-icon")
      .addEventListener("click", 
          (e) => {drawer.open = true;}
      );
     
    /* Handles Drawer Selections */
    document.querySelectorAll("aside.mdc-drawer a.mdc-list-item").forEach(item => {
        item.addEventListener('click', event => {
            document.querySelectorAll("aside.mdc-drawer a.mdc-list-item").forEach(item => {
                let c = item.getAttribute("href");
                let d = document.querySelector(c);
                d.style.display = "none";
            });
           
            drawer.open=false;
            
            let a = item.getAttribute("href");
            let b = document.querySelector(a);
            b.style.display="block";
            
            let e = document.getElementById("top-app-bar-title");
            e.textContent = b.querySelector("h1").textContent;
        })
    })
      
    document.getElementById("mapTopAppTarget").addEventListener('click', event => {
        crashUpdate();
        updateWeather();
    })
    
    let lat = 41.946733;
    let long = -87.674869;
      
    /* Geolocation updater */  
    let x = document.getElementById("demo");
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);  
      } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
      }
    } 
      
    function showPosition(position) {
      x.innerHTML = "Latitude: " + position.coords.latitude +
      "<br>Longitude: " + position.coords.longitude;
      lat = position.coords.latitude;
      long = position.coords.longitude;
    }    
    
    getLocation();  
      
    /* Map initializer */      
    function initMap() {
        let map = new google.maps.Map(document.getElementById('map'), {
          zoom: 13,
          center: {lat: lat, lng: long}
        });

        let bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);
    }
    
    let weatherKey = "ae2f450aa5475c3f63468e66c4ef93b2";  
    let weatherEndpoint = "https://api.openweathermap.org/data/2.5/weather?lat=" + lat + "&lon=" + long + "&appid=" + weatherKey;
    let weatherData;
    fetch(weatherEndpoint)
            .then(response => response.json())
            .then(json => {
                weatherData = json;
                updateWeather();
            })
            .catch(err => alert(err))
    
    let iconURL;
    let flavorText;
    const updateWeather = () => {
        iconURL = "https://openweathermap.org/img/wn/";
        let weatherType = weatherData.weather[0].description;
        let timeOfDay = weatherData.dt;
        let sunUp = weatherData.sys.sunrise;
        let sunDown = weatherData.sys.sunset;
        if(timeOfDay>sunUp && timeOfDay<sunDown)
        {
            timeOfDay="d";
        }else
        {
            timeOfDay="n";
        }
        switch(weatherType){
                case "clear sky": iconURL = iconURL + "01";
                flavorText="sunny ";
                break;
                case "few clouds": iconURL = iconURL + "02";
                flavorText="mildly cloudy";
                break;
                case "scattered clouds": iconURL = iconURL + "03";
                flavorText="scattered clouds";
                break;
                case "broken clouds": iconURL = iconURL + "04";
                flavorText="cloudy";
                break;
                case "shower rain": iconURL = iconURL + "09";
                flavorText="slightly showering";
                break;
                case "rain": iconURL = iconURL + "10";
                flavorText="raining";
                break;
                case "thunderstorm": iconURL = iconURL + "11";
                flavorText="thunderstorming";
                break;
                case "snow": iconURL = iconURL + "13";
                flavorText="snowing";
                break;
                case "mist": iconURL = iconURL + "50";
                flavorText="misting";
                break;
            default: iconURL = iconURL + "01";
                flavorText = "sunny";
                break;
        }
        iconURL = iconURL + timeOfDay + "@2x.png";
        let a = document.getElementById("weatherICON");
        a.setAttribute("src",iconURL);
        let b = document.getElementById("weatherText");
        let weatherString;
        let tempNum = weatherData.main.temp;
        if(document.getElementById("Celcius").checked)
        {
            tempNum = tempNum - 273.15;
            weatherString = tempNum.toFixed(2) + " °C and " + flavorText; 
        }
        if(document.getElementById("Farenheit").checked)
        {
            tempNum = tempNum*9/5 - 459.67;
            tempNum.toFixed(2);
            weatherString = tempNum.toFixed(2) + " °F and " + flavorText;
        }
        b.textContent = weatherString;
    }  
    
    let chicagoEndpoint = "https://data.cityofchicago.org/resource/85ca-t3if.json";
    let chiData;

    fetch(chicagoEndpoint)
      .then(response => response.json())
      .then(json => {
            chiData=json;
            crashUpdate();
       })
      .catch(err => alert(err))
    
    const crashUpdate = () => {
        map = new google.maps.Map(document.getElementById('map'), {
           zoom: 13,
          center: {lat: lat, lng: long}
        });

        let bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);
        
        chiData.forEach(item => {
            let cityCircle = new google.maps.Circle({
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.35,
                map:map,
                center: {lat: parseFloat(item.latitude), lng: parseFloat(item.longitude)},
                radius: 35
            });  
        })
    }
    
    
    
    </script>
      
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQAgu7OzaiiQQL-gZMCTI9pKh6kBbVeIQ&callback=initMap">
    </script>  
  </body>
</html>